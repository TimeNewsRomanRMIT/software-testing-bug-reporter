<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Leaderboard</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Minor tweaks for the two sections */
    h2.section-title {
      margin-top: 2rem;
      font-size: 1.25rem;
      color: #333;
    }
    .board {
      margin-top: 1rem;
    }
    .board .card {
      margin-bottom: 0.75rem;
      padding: 0.75rem;
    }
    .board .card p {
      margin: 0.3rem 0;
      font-size: 0.95rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Hero banner -->
    <header class="hero-banner">
      <div class="logo-container">
        <img src="rmit-logo.png" alt="School Logo" class="logo">
      </div>
    </header>

    <!-- Page title -->
    <div class="card header-card">
      <h1>Bug Dashboard</h1>
    </div>

    <!-- Section 1: Team Leaderboard -->
    <h2 class="section-title">Team Leaderboard</h2>
    <div id="team-board" class="board">
      <p>Loading team leaderboard…</p>
    </div>

    <!-- Section 2: Unique Bugs -->
    <h2 class="section-title">Unique Bugs (by URL & Description)</h2>
    <div id="unique-board" class="board">
      <p>Loading unique bugs…</p>
    </div>

    <!-- Back link -->
    <div class="buttons">
      <a href="index.html" class="button">← Report Bugs</a>
      <a href="submissions.html" class="button">View All Submissions →</a>
    </div>
  </div>

  <script>
    // 1) Load the existing team leaderboard
    async function loadTeamBoard() {
      const res  = await fetch('/api/bugs/leaderboard');
      const data = await res.json();  // [{team, urlCount, bugCount}, ...]
      const el   = document.getElementById('team-board');
      el.innerHTML = '';

      if (!data.length) {
        return el.textContent = 'No data yet—submit some bugs!';
      }

      data.forEach(({team, urlCount, bugCount}, i) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <p><strong>${i+1}. ${team}</strong></p>
          <p>${urlCount} URL${urlCount>1?'s':''} — ${bugCount} bug${bugCount>1?'s':''}</p>
        `;
        el.appendChild(card);
      });
    }

    // 2) Load the unique-bugs groups
    async function loadUniqueBoard() {
      const res  = await fetch('/api/bugs/groups');
      const data = await res.json();  // [{url, description, teamCount, teams}, ...]
      const el   = document.getElementById('unique-board');
      el.innerHTML = '';

      if (!data.length) {
        return el.textContent = 'No bugs reported yet.';
      }

      data.forEach(({url, description, teamCount, teams}, i) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <p><strong>${i+1}. <a href="${url}" target="_blank">${url}</a></strong></p>
          <p>${description}</p>
          <p>${teamCount} team${teamCount>1?'s':''} reported this</p>
          <details>
            <summary>View teams</summary>
            <ul>
              ${teams.map(t => `<li>${t}</li>`).join('')}
            </ul>
          </details>
        `;
        el.appendChild(card);
      });
    }

    // Kick off both
    loadTeamBoard().catch(err => {
      document.getElementById('team-board').textContent = 'Error loading team leaderboard';
      console.error(err);
    });
    loadUniqueBoard().catch(err => {
      document.getElementById('unique-board').textContent = 'Error loading unique bugs';
      console.error(err);
    });
  </script>
</body>
</html>
